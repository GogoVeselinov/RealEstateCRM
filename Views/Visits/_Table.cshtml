@model List<RealEstateCRM.Models.ViewModels.VisitListItemViewModel>
@using RealEstateCRM.Models.Common

<table class="table">
    <thead>
        <tr>
            <th>Дата и час</th>
            <th>Имот</th>
            <th>Клиент</th>
            <th>Статус</th>
            <th>Бележки</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @if (!Model.Any())
        {
            <tr><td colspan="6" class="muted">Няма данни</td></tr>
        }
        else
        {
            @foreach (var visit in Model)
            {
                <tr>
                    <td>
                        @visit.VisitAtLocal.ToString("dd.MM.yyyy HH:mm")
                        <br><small>(@visit.DurationMin мин.)</small>
                    </td>
                    <td>
                        <a href="/Properties/Details/@visit.PropertyId" style="text-decoration: none;">
                            @visit.PropertyTitle
                        </a>
                    </td>
                    <td>@(visit.ClientName ?? "—")</td>
                    <td>
                        <span class="badge" style="
                            @(visit.Status == VisitStatus.Scheduled ? "color: blue; border-color: blue;" : 
                              visit.Status == VisitStatus.Completed ? "color: green; border-color: green;" : 
                              visit.Status == VisitStatus.Cancelled ? "color: red; border-color: red;" : 
                              "color: orange; border-color: orange;")">
                            @visit.Status
                        </span>
                    </td>
                    <td style="max-width: 200px;">
                        @if (!string.IsNullOrWhiteSpace(visit.Notes))
                        {
                            <div style="max-height: 60px; overflow-y: auto; font-size: 0.9em;">
                                @visit.Notes
                            </div>
                        }
                        else
                        {
                            <span class="muted">—</span>
                        }
                    </td>
                    <td class="right">
                        <a href="/Visits/Details/@visit.Id" class="btn secondary" style="font-size: 0.8em; padding: 4px 8px; text-decoration: none; display: inline-block;">Детайли</a>
                        @if ((bool)(ViewBag.CanEdit ?? false))
                        {
                            @if (visit.Status == VisitStatus.Scheduled)
                            {
                                <button class="btn secondary" onclick="setStatus('@visit.Id', 'Completed')" style="font-size: 0.8em; padding: 4px 8px;">Завърши</button>
                                <button class="btn secondary" onclick="setStatus('@visit.Id', 'Cancelled')" style="font-size: 0.8em; padding: 4px 8px;">Отмени</button>
                            }
                            <button class="btn secondary" onclick="openEdit('@visit.Id')" style="font-size: 0.8em; padding: 4px 8px;">Редактирай</button>
                            <button class="btn secondary" onclick="ics('@visit.Id')" style="font-size: 0.8em; padding: 4px 8px;">ICS</button>
                            <button class="btn secondary" onclick="del('@visit.Id')" style="font-size: 0.8em; padding: 4px 8px;">Изтрий</button>
                        }
                    </td>
                </tr>
            }
        }
    </tbody>
</table>

@Html.AntiForgeryToken()